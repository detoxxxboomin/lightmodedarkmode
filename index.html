<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Light vs Dark Mode Experiment</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 600px;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin: 20px;
            width: 90%;
        }

        /* Light Mode Styles */
        .light-mode-bg {
            background-color: #ffffff;
            color: #000000;
        }
        .light-mode-bg .container {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
        }

        /* Dark Mode Styles */
        .dark-mode-bg {
            background-color: #121212;
            color: #ffffff;
        }
        .dark-mode-bg .container {
            background-color: #1e1e1e;
            border: 1px solid #333;
        }

        /* General Styles */
        h1, h2 {
            margin-top: 0;
        }

        p {
            line-height: 1.6;
            font-size: 1.1rem;
        }

        button {
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #4CAF50;
            color: white;
            margin-top: 20px;
            width: 100%;
        }

        button:hover {
            background-color: #45a049;
        }

        .hidden {
            display: none;
        }

        .survey-box {
            background: #eee;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        /* Quiz Styles */
        .question {
            margin-bottom: 15px;
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }
        
        .dark-mode-bg .question {
            border-bottom: 1px solid #444;
        }

        label {
            display: block;
            margin: 5px 0;
            cursor: pointer;
        }

        /* Results Table */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .dark-mode-bg th, .dark-mode-bg td {
            border-color: #444;
        }

        .thank-you-msg {
            font-size: 1.4rem;
            color: #4CAF50;
            font-weight: bold;
            margin-top: 30px;
            text-align: center;
        }

        #save-status {
            font-size: 0.8rem;
            text-align: center;
            margin-top: 10px;
            color: #666;
        }
    </style>
</head>
<body class="light-mode-bg">

    <!-- Screen 1: Introduction & Survey -->
    <div id="intro-screen" class="container">
        <h1>Science Project: Light vs. Dark</h1>
        <p>Welcome! Thank you for volunteering.</p>
        
        <div class="survey-box" style="color: black;">
            <p><strong>Step 1: Environment Survey</strong></p>
            <p>What is the lighting like in your room right now?</p>
            <label><input type="radio" name="room-light" value="Bright"> Brightly Lit (Sunny or overhead lights)</label>
            <label><input type="radio" name="room-light" value="Dim"> Dimly Lit (Dark or low light)</label>
        </div>

        <p><strong>Instructions:</strong></p>
        <ol>
            <li>You will read two short stories.</li>
            <li>Click "I'm Finished" as soon as you are done reading.</li>
            <li>Answer 3 short questions after each story.</li>
        </ol>
        <button onclick="checkSurveyAndStart()">Start Experiment</button>
        <p id="survey-error" style="color: red; display: none; font-size: 0.9rem;">Please select a room lighting option first!</p>
    </div>

    <!-- Screen 2: Story A (Light Mode) -->
    <div id="story-a-screen" class="container hidden">
        <h2>Story 1: The Lost Key</h2>
        <p>Sammy was playing in the backyard when he realized his pocket felt light. He tapped his jeans. Empty! The shiny silver key to the garden shed was gone. "Oh no," Sammy whispered. His dad needed that key to get the lawnmower.</p>
        <p>Sammy retraced his steps. He looked by the swings. Nothing. He looked inside the sandbox. Nothing but sand. He started to worry. The sun was getting hot, and he wiped sweat from his forehead.</p>
        <p>Just then, he saw a glimmer near the flower pots. A crow was hopping away from a shiny object. It was the key! The crow must have tried to steal it. Sammy grabbed the key and ran inside, happy that he had saved the day.</p>
        <button onclick="finishStoryA()">I'm Finished Reading</button>
    </div>

    <!-- Screen 3: Quiz A (Light Mode) -->
    <div id="quiz-a-screen" class="container hidden">
        <h2>Quiz 1</h2>
        <div class="question">
            <p>1. What did Sammy lose?</p>
            <label><input type="radio" name="q1" value="coin"> A gold coin</label>
            <label><input type="radio" name="q1" value="key"> A silver key</label>
            <label><input type="radio" name="q1" value="toy"> A toy car</label>
        </div>
        <div class="question">
            <p>2. Where did he find it?</p>
            <label><input type="radio" name="q2" value="sandbox"> In the sandbox</label>
            <label><input type="radio" name="q2" value="flower"> Near the flower pots</label>
            <label><input type="radio" name="q2" value="grass"> In the tall grass</label>
        </div>
        <div class="question">
            <p>3. What animal was near the item?</p>
            <label><input type="radio" name="q3" value="dog"> A dog</label>
            <label><input type="radio" name="q3" value="crow"> A crow</label>
            <label><input type="radio" name="q3" value="cat"> A cat</label>
        </div>
        <button onclick="submitQuizA()">Submit Answers</button>
    </div>

    <!-- Screen 4: Break (Neutral) -->
    <div id="break-screen" class="container hidden">
        <h1>Great Job!</h1>
        <p>You have finished the first part.</p>
        <p>Take a deep breath and rest your eyes for a moment.</p>
        <p>In the next part, the screen will turn dark.</p>
        <button onclick="startPartTwo()">Ready for Part 2</button>
    </div>

    <!-- Screen 5: Story B (Dark Mode) -->
    <div id="story-b-screen" class="container hidden">
        <h2>Story 2: The Space Lunch</h2>
        <p>Astronaut Leo was very hungry. Being in zero gravity made doing simple things very hard. He opened his lunch bag and pulled out a peanut butter sandwich. "Finally," he said.</p>
        <p>Suddenly, the ship bumped into a tiny rock. The sandwich floated out of Leo's hand! It spun slowly in the air, drifting toward the control panel. "Don't touch the buttons!" Leo yelled at the sandwich.</p>
        <p>Leo pushed off the wall and floated across the room. He grabbed his butterfly net, which he used for science experiments. Swish! He caught the sandwich just before it hit the red emergency button. Leo sighed with relief and took a big bite.</p>
        <button onclick="finishStoryB()">I'm Finished Reading</button>
    </div>

    <!-- Screen 6: Quiz B (Dark Mode) -->
    <div id="quiz-b-screen" class="container hidden">
        <h2>Quiz 2</h2>
        <div class="question">
            <p>1. What was Leo trying to eat?</p>
            <label><input type="radio" name="q4" value="pizza"> Pizza</label>
            <label><input type="radio" name="q4" value="sandwich"> A sandwich</label>
            <label><input type="radio" name="q4" value="apple"> An apple</label>
        </div>
        <div class="question">
            <p>2. Why did the food float away?</p>
            <label><input type="radio" name="q5" value="wind"> The wind blew it</label>
            <label><input type="radio" name="q5" value="bump"> The ship bumped a rock</label>
            <label><input type="radio" name="q5" value="drop"> He dropped it</label>
        </div>
        <div class="question">
            <p>3. What did he use to catch it?</p>
            <label><input type="radio" name="q6" value="net"> A butterfly net</label>
            <label><input type="radio" name="q6" value="hands"> His bare hands</label>
            <label><input type="radio" name="q6" value="bag"> A paper bag</label>
        </div>
        <button onclick="submitQuizB()">Submit Answers</button>
    </div>

    <!-- Screen 7: Results -->
    <div id="results-screen" class="container hidden">
        <h1>Experiment Complete!</h1>
        <p>Room Lighting: <strong id="res-room-light">-</strong></p>
        <p>Your results are shown below:</p>
        
        <table style="color: black;">
            <thead>
                <tr>
                    <th>Mode</th>
                    <th>Time (Seconds)</th>
                    <th>Score</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Light Mode</td>
                    <td id="res-time-a">-</td>
                    <td id="res-score-a">-</td>
                </tr>
                <tr>
                    <td>Dark Mode</td>
                    <td id="res-time-b">-</td>
                    <td id="res-score-b">-</td>
                </tr>
            </tbody>
        </table>

        <p class="thank-you-msg">Thank you for participating!</p>
        <p id="save-status">Connecting to project database...</p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

        // Your specific Firebase credentials
        const firebaseConfig = {
            apiKey: "AIzaSyAdZU76cO6hjhQt9h0PgnLoL9hpA7eHToc",
            authDomain: "lightmodedarkmode-d6305.firebaseapp.com",
            projectId: "lightmodedarkmode-d6305",
            storageBucket: "lightmodedarkmode-d6305.firebasestorage.app",
            messagingSenderId: "394258467768",
            appId: "1:394258467768:web:ee7b55eeaeec0fbf53dd4d"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let currentUser = null;

        // Sign in right away so we are ready to save at the end
        signInAnonymously(auth).catch(err => {
            console.error("Auth failed:", err);
            document.getElementById('save-status').innerText = "⚠ Database connection failed.";
        });

        onAuthStateChanged(auth, (u) => { 
            currentUser = u; 
            if(u) {
                document.getElementById('save-status').innerText = "Database Connected.";
            }
        });

        async function uploadData() {
            if (!currentUser) {
                document.getElementById('save-status').innerText = "⚠ Not signed in. Data not saved.";
                return;
            }
            
            try {
                document.getElementById('save-status').innerText = "Saving data...";
                // Saving to a collection called 'experiment_results'
                const resultsRef = collection(db, 'experiment_results');
                await addDoc(resultsRef, {
                    roomLight: window.roomLight,
                    timeLightMode: parseFloat(window.timeA),
                    scoreLightMode: window.scoreA,
                    timeDarkMode: parseFloat(window.timeB),
                    scoreDarkMode: window.scoreB,
                    timestamp: serverTimestamp(),
                    userId: currentUser.uid
                });
                document.getElementById('save-status').innerText = "✓ Data saved to cloud successfully!";
            } catch (e) {
                console.error("Firebase Error:", e);
                document.getElementById('save-status').innerText = "⚠ Error saving: " + e.message;
            }
        }

        // --- EXPERIMENT LOGIC ---
        let startTime, endTime;
        window.timeA = 0; window.timeB = 0;
        window.scoreA = 0; window.scoreB = 0;
        window.roomLight = "";

        const answersA = { q1: 'key', q2: 'flower', q3: 'crow' };
        const answersB = { q4: 'sandwich', q5: 'bump', q6: 'net' };

        function showScreen(id) {
            document.querySelectorAll('.container').forEach(el => el.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        window.checkSurveyAndStart = function() {
            const selected = document.querySelector('input[name="room-light"]:checked');
            if (selected) {
                window.roomLight = selected.value;
                document.getElementById('survey-error').style.display = 'none';
                showScreen('story-a-screen');
                startTime = Date.now();
            } else {
                document.getElementById('survey-error').style.display = 'block';
            }
        }

        window.finishStoryA = function() {
            endTime = Date.now();
            window.timeA = ((endTime - startTime) / 1000).toFixed(2);
            showScreen('quiz-a-screen');
        }

        window.submitQuizA = function() {
            window.scoreA = calculateScore(answersA, ['q1', 'q2', 'q3']);
            showScreen('break-screen');
        }

        window.startPartTwo = function() {
            document.body.classList.replace('light-mode-bg', 'dark-mode-bg');
            showScreen('story-b-screen');
            startTime = Date.now();
        }

        window.finishStoryB = function() {
            endTime = Date.now();
            window.timeB = ((endTime - startTime) / 1000).toFixed(2);
            showScreen('quiz-b-screen');
        }

        window.submitQuizB = function() {
            window.scoreB = calculateScore(answersB, ['q4', 'q5', 'q6']);
            showResults();
        }

        function calculateScore(answerKey, questionNames) {
            let score = 0;
            questionNames.forEach(name => {
                const selected = document.querySelector(`input[name="${name}"]:checked`);
                if (selected && selected.value === answerKey[name]) {
                    score++;
                }
            });
            return score;
        }

        function showResults() {
            document.body.classList.replace('dark-mode-bg', 'light-mode-bg');
            document.getElementById('res-room-light').innerText = window.roomLight;
            document.getElementById('res-time-a').innerText = window.timeA + "s";
            document.getElementById('res-score-a').innerText = window.scoreA + "/3";
            document.getElementById('res-time-b').innerText = window.timeB + "s";
            document.getElementById('res-score-b').innerText = window.scoreB + "/3";

            showScreen('results-screen');
            uploadData();
        }
    </script>
</body>
</html>
